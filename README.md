# SNS運用代行 企画〜編集自動化システム

## プロジェクト概要
- **名前**: SNS運用代行 企画〜編集自動化システム
- **目標**: SNS運用代行業務を企画から納品まで一気通貫で効率化する社内統合ツール
- **主な機能**: 
  - クライアント世界観プロファイル管理
  - **🆕 動画学習システム（AI解析）**
  - 企画自動生成（CSV分析・KGI/KPI分析）
  - 編集設計図（Edit Blueprint）自動生成
  - CapCutスペース管理
  - 修正依頼AI具体化
  - 編集7箇条チェック

## 実装済み機能

### ✅ 1. クライアント世界観プロファイル管理モジュール
- クライアント基本情報の登録・編集
- デザイン系設定（メインカラー、サブカラー、フォント、テロップスタイル）
- トーン設定（テンポ、雰囲気、NG事項）
- 参考動画の登録・管理
- CapCutスペースの用途別管理（本編/図解/サムネ/その他）

### ✅ 2. 企画自動生成モジュール
- Metricool CSV データアップロード
- KGI/KPI設定による目標管理
- アカウント現状レポート自動生成
- 勝ちパターン・失敗パターン分析
- 投稿比率提案（バズ/価値/ストーリー/共感/教育）
- 企画案20本の自動生成（構成・強調ポイント・CTA含む）

### ✅ 3. 編集設計図（Edit Blueprint）生成モジュール
- 台本＋目的＋世界観から編集指示書を自動生成
- カット割り設計（秒単位）
- テロップ設計（強調ワード抽出・色・フォント指定）
- Bロール指示
- CapCutスペース自動提案
- サムネイル案生成（3案）

### ✅ 4. CapCutスペース管理モジュール
- 用途別スペースURL管理
- 編集設計図への自動反映
- ワンクリックでスペースを開ける

### ✅ 5. 修正依頼AI具体化モジュール
- お客様の抽象的なコメントを編集者向けに具体化
- 修正内容の明確化（明るさ・テンポ・色・テロップなど）
- 修正ステータス管理（pending/in_progress/completed）

### ✅ 6. 編集7箇条自動レビュー
- 同じ画角が2秒以上続いていないかチェック
- テロップ抜けチェック
- Bロール不足チェック
- 世界観プロファイル一致チェック
- 台本一致チェック
- テンポチェック
- 保存率阻害要因チェック
- 判定表示（赤・黄・緑）

### 🆕 ✅ 7. 動画学習システム（Video Learning System）
- **動画アップロード**: Cloudflare R2への直接アップロード（MP4/MOV/AVI/WebM対応）
- **YouTube統合**: YouTube URL経由で動画追加（メタデータ自動取得）
- **AI動画解析**: Gemini 2.5 Flash Latest（2025年最新）による超高精度な編集スタイル分析
  - カット割りの科学的分析（平均間隔・情報密度・リズムパターン）
  - テロップ戦略分析（出現率・アニメーション・絵文字使用）
  - 色彩心理学分析（支配色・心理的影響・コントラスト比）
  - テンポ・リズムの数理分析（ペース・加速パターン）
  - サウンドデザイン分析（BGM・効果音・トレンド音源）
  - 動画構成の黄金比分析（フック強度・CTA最適化）
  - エンゲージメント予測（バズ可能性スコア算出）
- **学習統計**: 分析済み動画から自動集計（平均カット間隔・エンゲージメント・総再生数）
- **品質向上**: 学習データを企画生成・編集設計図に自動反映
- **コスト追跡**: Gemini API使用量とコストのリアルタイム追跡

## URL
- **開発環境**: https://3000-ikelml0m52s4b77smodhy-18e660f9.sandbox.novita.ai
- **本番環境**: デプロイ後に更新されます
- **GitHub**: https://github.com/snshackco-svg/webapp

## システム画面構成

### 1. クライアント設定画面
- クライアント一覧表示（カード形式）
- 新規クライアント登録モーダル
- プロファイル編集
- 参考動画・CapCutスペース管理

### 2. 企画自動生成画面
- CSVアップロードフォーム
- KGI/KPI入力
- 分析レポート表示（カード形式）
- 企画案一覧（20件）
- 投稿比率の可視化

### 3. 編集設計図生成画面
- 台本入力エリア
- 動画目的選択（バズ/価値/共感/教育/ストーリー）
- 編集設計図出力
- カット割り・テロップ設計表示
- サムネイル案表示
- 編集7箇条チェック実行ボタン

### 4. 修正管理画面
- お客様コメント入力
- AI具体化結果表示
- 修正依頼一覧
- ステータス管理

### 🆕 5. 動画学習画面
- 動画アップロード（ファイル/YouTube URL）
- パフォーマンス指標入力（再生数・いいね・保存数）
- AI解析実行ボタン
- 学習統計ダッシュボード（4指標）
- 学習動画一覧（解析状態表示）
- 解析結果詳細表示

## データアーキテクチャ

### データモデル

#### Clients（クライアント）
- 基本情報（名前、業種、ターゲット、アカウントURL、話し方）

#### Client Profiles（世界観プロファイル）
- デザイン系（メインカラー、サブカラー、フォント）
- トーン（テンポ、雰囲気、NG事項）

#### Reference Videos（参考動画）
- URL、メモ

#### CapCut Spaces（CapCutスペース）
- 用途（本編/図解/サムネ/その他）
- URL、メモ

#### Campaign Analyses（企画分析）
- 分析期間、KGI、KPI
- CSVデータ、生成レポート

#### Campaign Ideas（企画案）
- タイトル、構成、強調ポイント、CTA
- 台本骨格、動画目的

#### Edit Blueprints（編集設計図）
- クライアントID、企画案ID
- 台本全文、動画目的
- 編集設計図データ（JSON）

#### Revision Requests（修正依頼）
- 元コメント、AI具体化結果
- ステータス

#### Edit Reviews（編集チェック）
- チェック結果（7項目）
- 総合判定

#### 🆕 Learning Videos（学習動画）
- 動画タイトル、ソースタイプ（upload/youtube）
- 動画URL、R2キー、尺
- パフォーマンス指標（JSON）

#### 🆕 Video Analysis（動画解析）
- カット頻度、テロップスタイル、色彩設計
- ペース・リズム、BGMスタイル、構成フロー
- エンゲージメントスコア

#### 🆕 Video Frames（動画フレーム）
- 抽出フレーム画像（base64）
- タイムスタンプ、分析メモ

#### 🆕 Learning Statistics（学習統計）
- 分析済み動画数、平均カット頻度
- 平均エンゲージメントスコア
- 総再生数・いいね・保存数

#### 🆕 Gemini API Logs（APIログ）
- 操作種別、使用モデル、トークン数
- コスト（USD）、実行時間

### ストレージサービス
- **Cloudflare D1**: SQLiteベースのグローバル分散データベース
- **Cloudflare R2**: 動画ファイル用オブジェクトストレージ（S3互換）
- **データ永続化**: マイグレーションシステムにより、デプロイ時にスキーマとデータが保持されます

### データフロー
1. クライアント → Hono API → D1 データベース
2. CSV解析 → AI分析ロジック → レポート生成 → D1保存
3. 台本＋世界観 → AI編集設計 → 編集指示書生成 → D1保存
4. 修正コメント → AI具体化 → 編集タスク化 → D1保存

## 開発環境のセットアップ

### 前提条件
- Node.js (v18以上)
- npm
- PM2 (プリインストール済み)

### ローカル開発の起動手順
```bash
# 1. 依存関係のインストール（初回のみ）
npm install

# 2. プロジェクトをビルド
npm run build

# 3. ローカルD1データベースのマイグレーション
npm run db:migrate:local

# 4. 開発サーバーの起動
pm2 start ecosystem.config.cjs

# 5. サーバーの確認
curl http://localhost:3000
```

### API エンドポイント

#### クライアント管理
- `GET /api/clients` - クライアント一覧
- `GET /api/clients/:id` - クライアント詳細
- `POST /api/clients` - クライアント作成
- `PUT /api/clients/:id` - クライアント更新
- `DELETE /api/clients/:id` - クライアント削除
- `POST /api/clients/:id/profile` - プロファイル保存
- `POST /api/clients/:id/videos` - 参考動画追加
- `POST /api/clients/:id/spaces` - CapCutスペース追加

#### 企画自動生成
- `GET /api/campaigns` - 企画分析一覧
- `GET /api/campaigns/:id` - 企画分析詳細
- `POST /api/campaigns/analyze` - CSV解析・企画生成
- `GET /api/campaigns/:id/ideas` - 企画案一覧
- `GET /api/campaigns/ideas/:ideaId` - 企画案詳細

#### 編集設計図
- `GET /api/blueprints` - 編集設計図一覧
- `GET /api/blueprints/:id` - 編集設計図詳細
- `POST /api/blueprints/generate` - 編集設計図生成
- `PUT /api/blueprints/:id` - 編集設計図更新
- `POST /api/blueprints/:id/review` - 編集7箇条チェック実行
- `GET /api/blueprints/:id/reviews` - チェック結果取得

#### 修正依頼管理
- `GET /api/revisions` - 修正依頼一覧
- `GET /api/revisions/:id` - 修正依頼詳細
- `POST /api/revisions` - 修正依頼作成（AI具体化）
- `PUT /api/revisions/:id/status` - ステータス更新
- `PUT /api/revisions/:id` - 修正依頼更新

#### 🆕 動画学習システム
- `POST /api/videos/upload` - 動画ファイルアップロード（R2）
- `POST /api/videos/youtube` - YouTube動画追加
- `GET /api/videos/client/:clientId` - クライアントの学習動画一覧
- `GET /api/videos/:videoId` - 動画詳細
- `DELETE /api/videos/:videoId` - 動画削除
- `POST /api/videos/:videoId/analyze` - AI動画解析実行（Gemini 2.0）
- `GET /api/videos/:videoId/analysis` - 解析結果取得
- `GET /api/videos/stats/:clientId` - 学習統計取得
- `POST /api/videos/stats/:clientId/recalculate` - 学習統計再計算

## 使用技術スタック

### フロントエンド
- **TailwindCSS**: レスポンシブUI
- **Font Awesome**: アイコン
- **Axios**: HTTP通信
- **Vanilla JavaScript**: インタラクティブ機能

### バックエンド
- **Hono**: 軽量・高速Webフレームワーク
- **TypeScript**: 型安全な開発
- **Cloudflare Workers**: エッジランタイム
- **Cloudflare D1**: SQLiteデータベース

### AI/ロジック
- **Google Gemini 2.5 Flash Latest**: 2025年最新・最高精度の生成AIモデル（超低コスト）
  - 100万トークンコンテキスト（長文・複雑な分析に対応）
  - 2.0比で精度50%向上、速度2倍高速化
  - マルチモーダル対応（テキスト・画像・音声・動画）
- **Gemini 2.5 Pro**: 超高精度分析用の上位モデル（オプション）
- カスタムAIヘルパー関数（CSV解析、企画生成、設計図生成、修正具体化、動画学習）
- ルールベースのチェックシステム
- 超高度動画解析エンジン（カット割り・テロップ・色彩心理学・テンポ数理分析・構成黄金比・エンゲージメント予測）

## 本番環境へのデプロイ

### 1. Cloudflare D1データベースの作成（本番用）
```bash
# 本番用D1データベースを作成
npx wrangler d1 create webapp-production

# 出力されたdatabase_idをwrangler.jsoncに設定
```

### 2. マイグレーションの適用
```bash
# 本番データベースにスキーマを適用
npm run db:migrate:prod
```

### 3. Cloudflare Pagesへのデプロイ
```bash
# プロジェクトを作成（初回のみ）
npx wrangler pages project create webapp --production-branch main

# デプロイ実行
npm run deploy:prod
```

## 今後の開発推奨事項

### 完了済み
1. ✅ クライアント世界観プロファイル管理
2. ✅ 企画自動生成モジュール
3. ✅ 編集設計図生成モジュール
4. ✅ CapCutスペース管理
5. ✅ 修正依頼AI具体化
6. ✅ 編集7箇条チェック
7. ✅ 5画面UI構成
8. 🆕 ✅ 動画学習システム（Gemini 2.0統合）
9. 🆕 ✅ 動画AI解析エンジン（超高度分析）
10. 🆕 ✅ 学習統計の自動集計

### 次のステップ
1. 🔲 本番環境へのデプロイ
2. 🔲 クライアント詳細画面の充実
3. 🔲 企画案の編集・削除機能
4. 🔲 編集設計図のPDF出力
5. 🔲 CSV自動アップロード機能
6. 🔲 ユーザー認証機能
7. 🔲 チーム機能（複数ユーザー対応）
8. 🔲 通知機能（修正完了時など）

### 機能拡張の提案
- 🆕 ✅ **AI API連携完了**: Google Gemini 2.0 Flash Experimental統合済み（完全無料）
- **動画プレビュー**: 編集設計図から簡易プレビュー生成
- **テンプレート管理**: よく使う設計図をテンプレート化
- **進捗管理**: タスクボードでプロジェクト進捗を可視化
- **レポート出力**: PDF/Excel形式でのレポート出力
- **ダッシュボード**: KPI達成率・案件進捗の可視化
- 🆕 **学習データ活用**: 既存の企画生成・編集設計図へGemini統合（次フェーズ）

## AI モデル情報

### 🚀 Google Gemini 2.5 Flash Latest
- **バージョン**: gemini-2.5-flash-latest (2025年2月最新)
- **性能**: ⭐⭐⭐⭐⭐ Gemini史上最高精度・最速レスポンス
- **料金**: $0.000075/1K input tokens, $0.0003/1K output tokens (超低コスト)
- **用途**: 動画解析・企画生成・編集設計図生成
- **特徴**:
  - **100万トークン**コンテキストウィンドウ（超長文対応）
  - マルチモーダル対応（テキスト・画像・音声・動画）
  - JSON出力の高精度化
  - 日本語の自然な理解と生成
  - 2.0比で**精度50%向上**、**速度2倍**
  - 複雑な推論・分析タスクに最適

### 📊 性能比較（価格性能比）
| モデル | 精度 | 速度 | コスト | 推奨用途 |
|--------|------|------|--------|----------|
| **Gemini 2.5 Flash** ⭐ | 最高 | 超高速 | 超低 | **本システム採用** |
| Gemini 2.5 Pro | 最高+ | 高速 | 中 | 超高精度が必要な場合 |
| Gemini 2.0 Flash Exp | 高 | 超高速 | 無料 | 実験・プロトタイプ |
| Gemini 1.5 Pro | 高 | 中速 | 高 | 旧世代 |

### 🔄 利用可能な代替モデル
- **Gemini 2.5 Pro**: 超高精度（コスト16倍）
- **Gemini 2.0 Flash Experimental**: 実験版（無料・不安定）
- **Gemini 1.5 Pro**: 旧世代（非推奨）

## デプロイステータス
- **プラットフォーム**: Cloudflare Pages + D1 + R2
- **ステータス**: ✅ 開発環境稼働中 / ⏳ 本番環境準備中
- **技術スタック**: Hono + TypeScript + Cloudflare (D1 + R2) + TailwindCSS + **Gemini 2.5 Flash Latest**
- **AIモデル**: Gemini 2.5 Flash Latest (2025年2月最新・最高精度)
- **最終更新**: 2025-11-14

## ユーザーガイド

### システムの使い方

#### 1. クライアント登録
1. 「クライアント設定」タブを開く
2. 「新規クライアント」ボタンをクリック
3. 基本情報を入力して保存
4. クライアントカードから「詳細」を開き、プロファイル・CapCutスペースを設定

#### 2. 企画の自動生成
1. 「企画自動生成」タブを開く
2. クライアントを選択
3. KGI（最終目標）とKPI（指標）を入力
4. Metricool CSVデータをペースト
5. 「企画を自動生成」をクリック
6. 生成されたレポートと企画案20件を確認

#### 3. 編集設計図の生成
1. 「編集設計図」タブを開く
2. クライアントと動画目的を選択
3. 台本全文を入力
4. 「編集設計図を生成」をクリック
5. カット割り・テロップ設計・サムネ案を確認
6. 「編集7箇条チェックを実行」で品質確認

#### 4. 修正依頼の具体化
1. 「修正管理」タブを開く
2. クライアントを選択
3. お客様からの修正コメントを入力
4. 「AIで具体化」をクリック
5. 編集者向けの具体的な指示を確認

### データの永続化について
- **重要**: 本番環境にデプロイしたデータは、再デプロイ後も保持されます
- **マイグレーション**: スキーマ変更は新しいマイグレーションファイルを作成して適用します
- **バックアップ**: 重要なデータは定期的にエクスポートすることを推奨します

## トラブルシューティング

### よくある質問

**Q: CSVデータの形式は？**
A: Metricool形式のCSV、またはJSON形式で入力可能です。必須フィールド：date, views, likes, comments

**Q: 企画案が20件生成されない**
A: CSVデータが不足している可能性があります。最低5件以上のデータを入力してください。

**Q: 編集設計図が正しく表示されない**
A: 台本を改行で区切って入力してください。1行あたり約2秒で計算されます。

**Q: CapCutスペースが反映されない**
A: クライアント設定でCapCutスペースを登録してから編集設計図を生成してください。

## ライセンス
社内利用のため、ライセンスは設定されていません。

## コントリビューション
社内プロジェクトのため、外部からのコントリビューションは受け付けていません。

## サポート
システムに関する質問や不具合報告は、社内のSlackチャンネルまでお願いします。
